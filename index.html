fetch(csvURL)
  .then(res => res.text())
  .then(data => {
    const rows = data.split("\n");
    const today = new Date();
    const mese = today.toLocaleString("default", { month: "long" });
    const anno = today.getFullYear();
    let codice = "Codice non trovato";

    console.log("Mese corrente:", mese, "Anno corrente:", anno); // Debug

    // Legge il CSV e trova il codice del mese corrente
    for (let i = 1; i < rows.length; i++) {
      const [meseAnno, codiceVal] = rows[i].split(",");
      const [meseCSV, annoCSV] = meseAnno.split(" ");
      
      console.log("Mese e anno CSV:", meseAnno); // Debug

      if (mese === meseCSV && anno == annoCSV) {
        codice = codiceVal.trim();
        console.log("Codice trovato:", codice); // Debug
        break;
      }
    }

    // Visualizza il codice trovato
    document.getElementById("codice-sbarra").innerHTML = 
      `Codice sbarra del mese:<br><span class="codice">${codice}</span>`;
  })
  .catch(() => {
    document.getElementById("codice-sbarra").textContent = "Errore nel caricamento del codice.";
  });
